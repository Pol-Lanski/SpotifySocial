{
  # Local certificates for localhost
  # Run: caddy trust
  auto_https disable_redirects
}

https://localhost:8443 {
  tls internal
  
  @api path /health /comments* /debug /auth* /static*

  # Handle CORS preflight locally (Chrome may send Private-Network preflights)
  @preflight {
    method OPTIONS
    path /health /comments* /debug /auth* /static*
  }
  header @preflight {
    Access-Control-Allow-Origin "https://open.spotify.com"
    Access-Control-Allow-Methods "GET, POST, OPTIONS, DELETE"
    Access-Control-Allow-Headers "Content-Type, Authorization"
    Access-Control-Allow-Private-Network "true"
  }
  respond @preflight 204
  
  reverse_proxy @api server:5050 {
    header_up X-Forwarded-Proto https
  }
}


